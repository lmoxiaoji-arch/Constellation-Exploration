<!DOCTYPE html>
<html lang="zh-CN" data-theme="day">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechSun | Swiss Tech Precision</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            /* Day Mode */
            --bg-color: #F5F7FA;
            --text-primary: #1A1A1A;
            --text-secondary: #555555;
            --accent-red: #E63946;
            --grid-line: rgba(0, 0, 0, 0.05);
            --surface: rgba(255, 255, 255, 0.9);
            --border: #E0E0E0;
            --card-size: 260px;
        }

        [data-theme="night"] {
            /* Night Mode */
            --bg-color: #0A0A0F;
            --text-primary: #FFFFFF;
            --text-secondary: #8888AA;
            --accent-red: #FF2E00;
            --grid-line: rgba(255, 255, 255, 0.05);
            --surface: rgba(20, 20, 30, 0.9);
            --border: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            /* Default to mono for data feel */
            overflow: hidden;
            /* For full screen app feel */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        h1,
        h2,
        h3,
        .brand {
            font-family: 'Space Grotesk', sans-serif;
        }

        /* --- 1. Grid Background & Decor --- */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image:
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -1;
            pointer-events: none;
        }

        .crosshair {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 1px solid var(--accent-red);
            opacity: 0.5;
            z-index: 0;
        }

        .ch-tl {
            top: 40px;
            left: 40px;
            border-right: none;
            border-bottom: none;
        }

        .ch-tr {
            top: 40px;
            right: 40px;
            border-left: none;
            border-bottom: none;
        }

        .ch-bl {
            bottom: 40px;
            left: 40px;
            border-right: none;
            border-top: none;
        }

        .ch-br {
            bottom: 40px;
            right: 40px;
            border-left: none;
            border-top: none;
        }

        /* --- 2. Header --- */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            z-index: 100;
        }

        .brand {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand span {
            color: var(--accent-red);
        }

        .header-controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .btn-text {
            background: none;
            border: 1px solid var(--border);
            padding: 8px 16px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            text-transform: uppercase;
        }

        .btn-text:hover {
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        /* --- 3. Hero Section (Visitor) --- */
        .hero {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0 10vw;
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 8vw;
            line-height: 0.9;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .hero h1 span {
            color: var(--accent-red);
            /* SWISS RED */
            display: block;
            margin-left: 5vw;
        }

        .hero-meta {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 40px;
            max-width: 600px;
            border-top: 1px solid var(--border);
            padding-top: 20px;
        }

        .hero-meta div h3 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .hero-meta div p {
            font-size: 16px;
        }

        /* --- 4. Login Overlay --- */
        .login-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--surface);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            padding: 40px;
            width: 360px;
            z-index: 200;
            display: none;
            /* Hidden by default */
            box-shadow: var(--shadow-soft);
        }

        .login-panel.active {
            display: block;
        }

        .login-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: inherit;
        }

        .login-form button {
            width: 100%;
            padding: 12px;
            background: var(--text-primary);
            color: var(--bg-color);
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .login-form button:hover {
            background: var(--accent-red);
        }

        /* --- 5. Icons Grid (Bottom) --- */
        .icon-dock {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            align-items: flex-end;
            z-index: 10;
        }

        .icon-item {
            text-align: center;
            opacity: 0.7;
            transition: 0.3s;
            cursor: pointer;
        }

        .icon-item:hover {
            opacity: 1;
            transform: translateY(-5px);
        }

        .icon-box {
            width: 48px;
            height: 48px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            background: var(--bg-color);
        }

        .icon-label {
            font-size: 10px;
            text-transform: uppercase;
        }

        /* --- 6. 3D Archives Layer --- */
        #archives-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            background: var(--bg-color);
            opacity: 0;
            pointer-events: none;
            /* Pass through when hidden */
            transition: opacity 0.5s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
            display: none;
            /* Completely hide when not active to save perf */
        }

        #archives-layer.active {
            opacity: 1;
            pointer-events: auto;
            display: block;
        }

        .stage {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transform: rotateY(5deg);
        }

        .card-wrapper {
            position: absolute;
            width: var(--card-size);
            height: var(--card-size);
            top: 50%;
            left: 50%;
            margin-top: calc(var(--card-size) / -2);
            margin-left: calc(var(--card-size) / -2);
            transform-style: preserve-3d;
            transition: opacity 0.1s ease;
            backface-visibility: hidden;
        }

        .card-content {
            width: 100%;
            height: 100%;
            background-color: #1a1a1a;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.4s ease, border-color 0.4s;
        }

        .card-wrapper:hover .card-content {
            transform: scale(1.1) translateZ(20px);
            border-color: var(--accent-red);
        }

        /* Client Dashboard UI */
        .client-header {
            position: fixed;
            top: 100px;
            left: 40px;
            z-index: 60;
            display: none;
        }

        .client-active .client-header {
            display: block;
        }

        .view-toggle-btn {
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <!-- Background -->
    <div class="bg-grid"></div>
    <div class="crosshair ch-tl"></div>
    <div class="crosshair ch-tr"></div>
    <div class="crosshair ch-bl"></div>
    <div class="crosshair ch-br"></div>

    <!-- Header -->
    <header>
        <div class="brand">
            TECH<span>SUN</span>
        </div>
        <div class="header-controls">
            <div id="user-info" style="display:none; font-size:12px;"></div>
            <button class="btn-text" id="toggle-theme">DAY/NIGHT</button>
            <button class="btn-text" id="btn-login">LOGIN</button>
            <button class="btn-text" id="btn-archives">ARCHIVES</button>
        </div>
    </header>

    <!-- Main Hero -->
    <div class="hero" id="hero-section">
        <h1>Swiss<br><span>Precision</span></h1>

        <div class="hero-meta">
            <div>
                <h3>ESTABLISHED</h3>
                <p>1999 . SHANGHAI</p>
            </div>
            <div>
                <h3>EXPERTISE</h3>
                <p>Anti-Counterfeit<br>Smart Packaging</p>
            </div>
        </div>
    </div>

    <!-- Icons Dock (Static for now) -->
    <div class="icon-dock">
        <div class="icon-item">
            <div class="icon-box">‚òÅÔ∏è</div>
            <div class="icon-label">Cloud</div>
        </div>
        <div class="icon-item">
            <div class="icon-box">üì¶</div>
            <div class="icon-label">Soft</div>
        </div>
        <div class="icon-item">
            <div class="icon-box">üß¢</div>
            <div class="icon-label">Cap</div>
        </div>
        <div class="icon-item">
            <div class="icon-box">üè∑Ô∏è</div>
            <div class="icon-label">Label</div>
        </div>
        <div class="icon-item">
            <div class="icon-box">ü•´</div>
            <div class="icon-label">Metal</div>
        </div>
        <div class="icon-item">
            <div class="icon-box">üö¨</div>
            <div class="icon-label">Tobacco</div>
        </div>
        <div class="icon-item">
            <div class="icon-box">üç∑</div>
            <div class="icon-label">Wine</div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="login-panel" id="login-panel">
        <h3 style="margin-bottom:20px; text-transform:uppercase;">Client Access</h3>
        <form class="login-form" id="login-form">
            <input type="text" id="client-name" placeholder="CLIENT NAME / ÂÆ¢Êà∑ÂßìÂêç" required>
            <input type="text" id="preview-code" placeholder="PREVIEW CODE / È¢ÑËßàÁ†Å" required>
            <button type="submit">VERIFY & ENTER</button>
        </form>
        <button class="btn-text" style="width:100%; margin-top:10px; border:none;"
            onclick="document.getElementById('login-panel').classList.remove('active')">CLOSE</button>
    </div>

    <!-- 3D Archives Layer -->
    <div id="archives-layer">
        <div class="client-header">
            <h2 id="archive-title">LITHOGRAPHY ARCHIVES</h2>
            <p id="archive-subtitle">SELECTED WORKS</p>
        </div>
        <div id="stage" class="stage"></div>
    </div>

    <!-- Logic -->
    <script>
        // --- 1. Theme Logic ---
        const btnTheme = document.getElementById('toggle-theme');
        btnTheme.addEventListener('click', () => {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            html.setAttribute('data-theme', current === 'day' ? 'night' : 'day');
        });

        // --- 2. Login & Navigation ---
        const btnLogin = document.getElementById('btn-login');
        const loginPanel = document.getElementById('login-panel');
        const loginForm = document.getElementById('login-form');
        const heroSection = document.getElementById('hero-section');
        const archivesLayer = document.getElementById('archives-layer');
        const btnArchives = document.getElementById('btn-archives');

        let isClientMode = false;

        btnLogin.addEventListener('click', () => {
            // If logged in, logout
            if (localStorage.getItem('token')) {
                localStorage.removeItem('token');
                window.location.reload();
                return;
            }
            loginPanel.classList.add('active');
        });

        // Show Archives (Public or Client)
        btnArchives.addEventListener('click', () => {
            toggleArchives(true);
        });

        // Close archives when clicking outside cards? No, need a close button or back.
        // For now, let's make the logo go back home

        function toggleArchives(show) {
            if (show) {
                archivesLayer.classList.add('active');
                heroSection.style.opacity = '0';
                initArchives3D();
            } else {
                archivesLayer.classList.remove('active');
                heroSection.style.opacity = '1';
                stopArchives3D();
            }
        }

        // --- 3. Login API ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('client-name').value;
            const code = document.getElementById('preview-code').value;

            try {
                const res = await fetch('http://localhost:3000/api/verify-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ clientName: name, code: code })
                });
                const data = await res.json();

                if (data.success) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('projectCode', data.projectCode);

                    // UI Update
                    loginPanel.classList.remove('active');
                    btnLogin.innerText = name + ' [LOGOUT]';
                    document.body.classList.add('client-active');

                    // Enter Client Dashboard (The Archives View but filtered)
                    document.getElementById('archive-title').innerText = "PROJECT DASHBOARD";
                    document.getElementById('archive-subtitle').innerText = "CLIENT: " + name;

                    isClientMode = true;
                    toggleArchives(true);

                    // Here we would fetch specific projects. For now, we mock the 3D cards
                } else {
                    alert(data.message);
                }
            } catch (err) {
                console.error(err);
                alert('Connection error. Is server running?');
            }
        });

        // Check Login State on Load
        if (localStorage.getItem('token')) {
            btnLogin.innerText = 'CLIENT [LOGOUT]';
            isClientMode = true;
        }

        // --- 4. 3D Archives Logic (User's Code Adapted) ---
        let animationId;
        const stage = document.getElementById('stage');
        let cards = [];
        let progress = 0;
        let speed = 0.0003; // Restore speed
        let isDragging = false;
        let lastX = 0;
        let velocity = 0;

        // Init function to be called when layer shown
        function initArchives3D() {
            if (cards.length > 0) {
                update(); // Resume
                return;
            }

            stage.innerHTML = '';
            const CARD_COUNT = 12;

            for (let i = 0; i < CARD_COUNT; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';

                const content = document.createElement('div');
                content.className = 'card-content';
                // Mock Image - in real app, fetch from server
                const hue = i * 30;
                content.style.backgroundImage = `linear-gradient(135deg, hsl(${hue}, 20%, 20%), hsl(${hue}, 20%, 10%))`;

                content.innerHTML = `
                    <div class="card-info" style="transform: translateZ(20px);">
                        <div class="card-title" style="font-size:14px; font-weight:700;">PROJECT ${String(i + 1).padStart(2, '0')}</div>
                        <div class="card-sub" style="font-size:10px; opacity:0.7;">LITHOGRAPHY / DESIGN</div>
                    </div>
                `;

                // Interaction: Enter Project
                wrapper.addEventListener('click', () => {
                    const code = localStorage.getItem('projectCode') || 'LX8821';
                    // Go to viewer
                    window.location.href = `index.html?project=${code}&id=${i}`;
                });

                // Hover stop
                wrapper.addEventListener('mouseenter', () => { speed = 0; });
                wrapper.addEventListener('mouseleave', () => { speed = 0.0003; });

                wrapper.appendChild(content);
                stage.appendChild(wrapper);
                cards.push({ el: wrapper, offset: i / CARD_COUNT });
            }

            update();
        }

        // Global Events for 3D Drag
        window.addEventListener('mousedown', (e) => {
            if (!archivesLayer.classList.contains('active')) return;
            isDragging = true;
            lastX = e.clientX;
            speed = 0;
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const delta = e.clientX - lastX;
            lastX = e.clientX;
            velocity = delta * 0.0015;
            progress += velocity;
        });

        window.addEventListener('mouseup', () => {
            isDragging = false;
            speed = 0.0003;
        });

        function update() {
            if (!archivesLayer.classList.contains('active')) return;

            if (!isDragging) {
                progress += speed;
                if (Math.abs(velocity) > 0.00001) {
                    progress += velocity;
                    velocity *= 0.95;
                }
            }

            cards.forEach(card => {
                let p = (progress + card.offset) % 1;
                if (p < 0) p += 1;

                let x = -550 + p * 2000;
                let base_y = Math.sin(p * Math.PI) * 30;

                // Entry easing
                if (p < 0.05) {
                    let k = (0.05 - p) / 0.05;
                    x -= k * k * k * 250;
                }

                let z = 200 - (Math.pow(p, 1.2) * 2800);
                const rotateY = p * -60;

                let opacity = 1;
                if (p < 0.015) opacity = p / 0.015;
                if (p > 0.6) opacity = Math.max(0, 1 - (p - 0.6) / 0.25);

                card.el.style.transform = `translate3d(${x}px, ${base_y}px, ${z}px) rotateY(${rotateY}deg)`;
                card.el.style.opacity = opacity;
                card.el.style.zIndex = Math.floor((1 - p) * 1000);
            });

            animationId = requestAnimationFrame(update);
        }

        function stopArchives3D() {
            cancelAnimationFrame(animationId);
        }

    </script>
</body>

</html>